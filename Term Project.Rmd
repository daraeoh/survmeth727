---
title: "Food For Thought"
subtitle: 'SURVMETH 727 Term Project'
author: "Rebecca Oh, Alexa Zmich"
date: "December 2019"
output: pdf_document
---

## Setup
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(httr)
```

## Introduction

According to the  Journal of the American Medical Association, the leading cause of death in the United States in recent years is linked to unhealthful dietary factors (i.e. diabetes, cancer, etc). We make dietary choices every day, which affects our longevity. Thus, we are interested in finding how the food choices of U.S. households agree with the recommended number of servings to be eaten per day from each dietary food group. We will study these findings across different regions of the country (Northeast, Midwest, South, West) and this, in turn, will be compared with U.S. regional mortality rates. Therefore, the main research question of this report is "Is there a significant correlation between average food group proportion within household meals and mortality rates by U.S. region?"

## Methods (data (sources, gathering steps))

First, we will store Yelp's API key as an object, and we will use this object in the following API queries. 

```{r}
#create a token for use with API request
client_id <- "tuUnFmtQQZAX7YHwwbdz6g"
client_secret <- "PQL5AXms_2Yr6szyGBy2V6yH1sdeFS1g5S3od1WZxFKAD3IK0DEHC0mt1B8atTzO5mspVGcqxvA9gbAb_3u3_u07umTpSr0_YTdcTH9B4sP1UEXrvn713CzqPhzTXXYx"

res <- POST("https://api.yelp.com/oauth2/token",
            body = list(grant_type = "client_credentials",
                        client_id = client_id,
                        client_secret = client_secret))

token <- content(res)$access_token

#search url and collect data
yelp <- "https://api.yelp.com"
term <- "food"
location <- "MI"
categories <- NULL
limit <- 50
radius <- 8800
url <- modify_url(yelp, path = c("v3", "businesses", "search"),
                  query = list(term = term, location = location, 
                               limit = limit,
                               radius = radius))
res <- GET(url, add_headers('Authorization' = paste("bearer", client_secret)))

results <- content(res)

#parse data
yelp_httr_parse <- function(x) {

  parse_list <- list(id = x$id, 
                     name = x$name, 
                     categories = x$categories, 
                     rating = x$rating, 
                     review_count = x$review_count, 
                     latitude = x$coordinates$latitude, 
                     longitude = x$coordinates$longitude, 
                     address1 = x$location$address1, 
                     city = x$location$city, 
                     state = x$location$state, 
                     distance = x$distance)
  
  parse_list <- lapply(parse_list, FUN = function(x) ifelse(is.null(x), "", x))
  
  df <- data_frame(id=parse_list$id,
                   name=parse_list$name, 
                   categories = parse_list$categories, 
                   rating = parse_list$rating, 
                   review_count = parse_list$review_count, 
                   latitude=parse_list$latitude, 
                   longitude = parse_list$longitude, 
                   address1 = parse_list$address1, 
                   city = parse_list$city, 
                   state = parse_list$state, 
                   distance= parse_list$distance)
  df
}

results_list <- lapply(results$businesses, FUN = yelp_httr_parse)

restaurant_data <- do.call("rbind", results_list)
```

## Results (e.g.  graphs, exploratory analysis)